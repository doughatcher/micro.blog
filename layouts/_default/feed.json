{{- $pctx := . -}}
{{- if .IsHome -}}{{ $pctx = .Site }}{{- end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection -}}
{{- $pages = $pctx.RegularPages -}}
{{- else -}}
{{- $pages = $pctx.Pages -}}
{{- end -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
{{- $pages = $pages | first $limit -}}
{{- end -}}
{
    "version": "https://jsonfeed.org/version/1.1",
    "title": "{{ .Site.Title }}",
    "home_page_url": "{{ .Site.BaseURL }}",
    "feed_url": "{{ .Permalink }}",
    "description": "{{ .Site.Params.description | default .Site.Title }}",
    {{ with .Site.Params.author }}"author": {
        "name": "{{ . }}"
    },{{ end }}
    "items": [
        {{ range $index, $page := $pages }}
        {{ if $index }},{{ end }}
        {
            "id": "{{ .Permalink }}",
            "url": "{{ .Permalink }}",
            "title": "{{ .Title | default (truncate 50 .Summary) }}",
            "content_html": {{ .Content | jsonify }},
            "summary": {{ .Summary | jsonify }},
            "date_published": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}"{{ if .Lastmod }},
            "date_modified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}"{{ end }}{{ with .Params.tags }},
            "tags": [{{ range $tindex, $tag := . }}{{ if $tindex }},{{ end }}"{{ $tag }}"{{ end }}]{{ end }}
        }
        {{ end }}
    ]
}